{{define "history_tab"}}
{{if .Stats}}
<div class="history-stats">
    <div class="stat-item"><span class="stat-label">Total</span><span class="stat-value">{{.Stats.Total}}</span></div>
    <div class="stat-item stat-completed"><span class="stat-label">Completed</span><span class="stat-value">{{.Stats.Completed}}</span></div>
    <div class="stat-item stat-failed"><span class="stat-label">Failed</span><span class="stat-value">{{.Stats.Failed}}</span></div>
    <div class="stat-item stat-cancelled"><span class="stat-label">Cancelled</span><span class="stat-value">{{.Stats.Cancelled}}</span></div>
</div>
{{end}}

<div class="history-header">
    <h3 class="history-title">Recent Downloads</h3>
    {{if .HistoryJobs}}
    <button class="btn btn-danger btn-sm" hx-post="/htmx/history/clear"
        hx-confirm="Are you sure you want to clear all download history? This cannot be undone."
        hx-target="#tab-content" hx-swap="innerHTML">
        Clear All
    </button>
    {{end}}
</div>

{{if .HistoryJobs}}
<div class="job-list">
    {{range .HistoryJobs}}
    <div class="job">
        <div class="job-header">
            <span class="job-type">{{.Type}}</span>
            <span class="job-status status-{{.Status}}">{{.Status}}</span>
        </div>
        <div class="job-body">
            <div class="job-info">
                <div class="job-title">{{.SourceID}}</div>
                <div class="job-meta">
                    {{if .Progress}}Progress: {{printf "%.0f" .Progress}}%{{end}}
                </div>
                {{if .Error}}<div class="job-error">{{.Error}}</div>{{end}}
            </div>
            <div class="job-actions">
                {{if or (eq .Status "failed") (eq .Status "cancelled")}}
                <button hx-post="/htmx/retry/{{.ID}}" hx-target="#tab-content" hx-swap="innerHTML"
                    class="btn btn-outline btn-sm">Retry</button>
                {{end}}
                <div class="job-date">{{.UpdatedAt.Format "Jan 02, 15:04"}}</div>
            </div>
        </div>
    </div>
    {{end}}
</div>
{{else}}
<div class="empty">No download history yet.</div>
{{end}}
{{template "pagination" .Pagination}}
{{end}}