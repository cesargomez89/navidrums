{{define "history_tab"}}
{{if .Stats}}
<div class="history-stats">
    <div><strong>Total:</strong> {{.Stats.Total}}</div>
    <div><span class="job-status status-completed">Completed: {{.Stats.Completed}}</span></div>
    <div><span class="job-status status-failed">Failed: {{.Stats.Failed}}</span></div>
    <div><span class="job-status status-cancelled">Cancelled: {{.Stats.Cancelled}}</span></div>
</div>
{{end}}

<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
    <h3 style="margin: 0;">Recent Downloads</h3>
    {{if .HistoryJobs}}
    <button class="btn btn-danger btn-sm"
            hx-post="/htmx/history/clear"
            hx-confirm="Are you sure you want to clear all download history? This cannot be undone."
            hx-target="#tab-content"
            hx-swap="innerHTML">
        Clear All History
    </button>
    {{end}}
</div>

{{if .HistoryJobs}}
<div class="job-list">
    {{range .HistoryJobs}}
    <div class="job">
        <div class="job-info">
            <div class="job-title">{{.Title}}</div>
            <div class="job-meta">{{.Artist}}</div>
        </div>
        <div style="text-align: right;">
            <span class="job-status status-{{.Status}}">{{.Status}}</span>
            {{if .Error}}<div style="color: #ef4444; font-size: 0.75rem;">{{.Error}}</div>{{end}}
            {{if or (eq .Status "failed") (eq .Status "cancelled")}}
            <button hx-post="/htmx/retry/{{.ID}}" 
                    hx-target="#tab-content" 
                    hx-swap="innerHTML"
                    class="btn btn-outline btn-sm" style="margin-top: 8px;">Retry</button>
            {{end}}
            <div style="font-size: 0.75rem; color: var(--text-dim); margin-top: 4px;">{{.UpdatedAt.Format "Jan 02, 15:04"}}</div>
        </div>
    </div>
    {{end}}
</div>
{{else}}
<div class="empty">No download history yet.</div>
{{end}}
{{end}}
